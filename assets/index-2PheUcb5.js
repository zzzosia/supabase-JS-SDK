import{s as r}from"./api-client-VsTDM8De.js";const d=document.getElementById("logout-button"),l=document.getElementById("login-redirect"),f=document.getElementById("add-article-button"),c=document.getElementById("add-modal"),i=document.getElementById("edit-modal");r.auth.onAuthStateChange((e,n)=>{E(n)});function E(e){e?(d==null||d.classList.remove("hidden"),l==null||l.classList.add("hidden")):(d==null||d.classList.add("hidden"),l==null||l.classList.remove("hidden"))}async function w(){const{data:{session:e}}=await r.auth.getSession();E(e),await g()}w();d==null||d.addEventListener("click",async()=>{const{error:e}=await r.auth.signOut();e?console.error("Podczas wylogowywania wystąpił problem",e):(alert("Wylogowano"),window.location.href="login/")});async function g(){const[{data:e,error:n},{data:{session:s}}]=await Promise.all([r.from("article").select("*").order("created_at",{ascending:!1}),r.auth.getSession()]);if(n){console.error("Fetch error:",n);return}const t=document.querySelector(".articles");if(!t)return;const a=e.map(o=>`
    <article class="article py-6 bg-white/50 p-6 grid grid-cols-[auto_1fr] grid-rows-[auto_auto] gap-x-3 gap-y-2" data-id="${o.id}">
      <div class="col-start-2 row-start-1">
        <h2 class="text-xl font-semibold">${o.title}</h2>
        <h3 class="mt-2">${o.subtitle||""}</h3>
        <div class="text-sm text-primary/70 mt-2">
          <address class="not-italic mt-1.5" rel="author">${o.author}</address>
          <time datetime="${o.created_at}">${new Date(o.created_at).toLocaleDateString()}</time>
          <p class="mb-4 mt-1.5 whitespace-pre-wrap">${o.content}</p>
        </div>
      </div>
      <div class="col-start-2 row-start-2 flex space-x-2">
        ${s?`<button class="transition-transform duration-300 hover:scale-102 edit-button bg-primary hover:bg-hovering px-3 py-1 rounded text-white cursor-pointer">edytuj</button>
        <button class="transition-transform duration-300 hover:scale-102 delete-button bg-secondary text-white px-3 py-1 rounded hover:bg-hoveringS cursor-pointer">usuń</button>`:""}
      </div>
    </article>
  `).join(`
`);t.innerHTML=a}document.addEventListener("click",async e=>{if(e.target.classList.contains("edit-button")){const s=e.target.closest(".article").dataset.id,{data:t,error:a}=await r.from("article").select("*").eq("id",s).single();if(a){console.error("błąd...",a);return}document.getElementById("edit-id").value=t.id,document.getElementById("edit-title").value=t.title,document.getElementById("edit-subtitle").value=t.subtitle,document.getElementById("edit-content").value=t.content,document.getElementById("edit-author").value=t.author,i.showModal()}if(e.target.classList.contains("delete-button")){const s=e.target.closest(".article").dataset.id;if(!confirm("czy na pewno chcesz usunąć?"))return;const{error:a}=await r.from("article").delete().eq("id",s);if(a){console.error("błąd podczas usuwania",a);return}alert("usunięto"),g()}});f==null||f.addEventListener("click",async()=>{const{data:{session:e}}=await r.auth.getSession();if(!e){window.location.href="login/";return}c.showModal()});var h;(h=document.getElementById("cancel-add"))==null||h.addEventListener("click",()=>c.close());var v;(v=document.getElementById("cancel-edit"))==null||v.addEventListener("click",()=>i.close());var p;(p=document.getElementById("add-form"))==null||p.addEventListener("submit",async e=>{e.preventDefault();const n=document.getElementById("add-title").value,s=document.getElementById("add-subtitle").value,t=document.getElementById("add-content").value,a=document.getElementById("add-author").value,o=new Date().toISOString(),{error:u}=await r.from("article").insert([{title:n,subtitle:s,content:t,author:a,created_at:o}]);if(u){console.error("błąd podczas dodawania",u);return}c.close(),document.getElementById("add-form").reset(),g()});document.getElementById("edit-form").addEventListener("submit",async e=>{e.preventDefault();const n=document.getElementById("edit-id").value,s=document.getElementById("edit-title").value,t=document.getElementById("edit-subtitle").value,a=document.getElementById("edit-content").value,o=document.getElementById("edit-author").value,u=new Date().toISOString();console.log("Wysyłam update:",{id:n,title:s,subtitle:t,content:a,author:o,created_at:u});try{const{data:m,error:y}=await r.from("article").update({title:s,subtitle:t,content:a,author:o,created_at:u}).eq("id",n);if(y){console.error("Błąd podczas zapisu:",y),alert("Nie udało się zapisać: "+y.message);return}console.log("Update udany:",m),i.open&&i.close(),g()}catch(m){console.error("Exception:",m),alert("Nie udało się zapisać: "+m.message)}});c==null||c.addEventListener("click",e=>{c.querySelector("form").contains(e.target)||c.close()});i==null||i.addEventListener("click",e=>{i.querySelector("form").contains(e.target)||i.close()});
